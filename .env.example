# =============================================================================
# Bush Platform - Environment Variables
# =============================================================================
# Copy to .env.local and fill in real values.
# Variables marked [REQUIRED] have no defaults and must be set.
# Variables marked [SECRET] must never be committed to git.
#
# Source of truth: src/config/env.ts (Zod schema validates all variables)
# Spec reference:  specs/20-configuration-and-secrets.md
# =============================================================================

# -- App --
NODE_ENV=development
PORT=3001
HOST=0.0.0.0
LOG_LEVEL=debug                          # debug | info | warn | error
APP_URL=http://localhost:3000            # [REQUIRED] Next.js frontend URL
API_URL=http://localhost:3001            # [REQUIRED] Hono backend URL

# -- Database (SQLite) --
DATABASE_URL=./data/bush.db              # [REQUIRED] Relative to project root
DATABASE_WAL_MODE=true
DATABASE_BUSY_TIMEOUT=5000

# -- Redis --
REDIS_URL=redis://localhost:6379         # [REQUIRED]
REDIS_KEY_PREFIX=bush:

# -- WorkOS AuthKit --
WORKOS_API_KEY=sk_test_...               # [REQUIRED] [SECRET] WorkOS API key
WORKOS_CLIENT_ID=client_...              # [REQUIRED] WorkOS client ID
WORKOS_REDIRECT_URI=                     # Optional override for redirect URI
NEXT_PUBLIC_WORKOS_REDIRECT_URI=http://localhost:3000/auth/callback  # [REQUIRED] Must match WorkOS dashboard
WORKOS_WEBHOOK_SECRET=whsec_...          # [REQUIRED] [SECRET] WorkOS webhook signing secret
WORKOS_COOKIE_PASSWORD=                  # [SECRET] Cookie encryption (min 32 chars). Falls back to SESSION_SECRET.

# -- Object Storage (S3-compatible) --
STORAGE_PROVIDER=minio                   # minio | s3 | r2 | b2
STORAGE_ENDPOINT=http://localhost:9000   # [REQUIRED]
STORAGE_REGION=us-east-1
STORAGE_ACCESS_KEY=minioadmin            # [REQUIRED] [SECRET] S3 access key
STORAGE_SECRET_KEY=minioadmin            # [REQUIRED] [SECRET] S3 secret key
STORAGE_BUCKET=bush-primary              # [REQUIRED]
STORAGE_BUCKET_DERIVATIVES=              # Optional, defaults to primary bucket

# -- CDN --
CDN_PROVIDER=none                        # none | bunny | cloudfront | fastly
CDN_BASE_URL=                            # Empty for dev (serves from storage direct)
CDN_SIGNING_KEY=                         # [SECRET] CDN signing key

# -- Media Processing: Binaries --
FFMPEG_PATH=/usr/bin/ffmpeg
FFPROBE_PATH=/usr/bin/ffprobe
IMAGEMAGICK_PATH=/usr/bin/convert        # ImageMagick convert binary
IDENTIFY_PATH=/usr/bin/identify          # ImageMagick identify binary
DCRAW_PATH=/usr/bin/dcraw               # RAW image processor (deferred)
LIBREOFFICE_PATH=/usr/bin/libreoffice   # Document conversion (deferred)

# -- Media Processing: Behavior --
MEDIA_TEMP_DIR=/tmp/bush-processing      # Temp directory for processing
THUMBNAIL_FORMAT=webp                    # webp | jpeg
THUMBNAIL_QUALITY=80                     # 1-100
THUMBNAIL_POSITION=0.5                   # 0-1, where to extract video thumbnail
HLS_SEGMENT_DURATION=6                   # HLS segment length in seconds
PROXY_PRESET=medium                      # FFmpeg encoding preset

# -- Media Processing: Worker Concurrency --
WORKER_THUMBNAIL_CONCURRENCY=4
WORKER_FILMSTRIP_CONCURRENCY=2
WORKER_PROXY_CONCURRENCY=2
WORKER_WAVEFORM_CONCURRENCY=4
WORKER_METADATA_CONCURRENCY=8

# -- Transcription --
TRANSCRIPTION_PROVIDER=faster-whisper    # faster-whisper (dev/GPU) | deepgram (prod)
TRANSCRIPTION_MAX_DURATION=7200          # Max audio duration in seconds (2 hours)
DEEPGRAM_API_KEY=                        # [SECRET] Required when TRANSCRIPTION_PROVIDER=deepgram
ASSEMBLYAI_API_KEY=                      # [SECRET] Required when TRANSCRIPTION_PROVIDER=assemblyai
FASTER_WHISPER_URL=http://localhost:8080 # Required when TRANSCRIPTION_PROVIDER=faster-whisper

# -- Email (SMTP) --
SMTP_HOST=localhost
SMTP_PORT=1025                           # Mailpit default port for dev
SMTP_USER=
SMTP_PASS=                               # [SECRET]
SMTP_FROM=noreply@bush.local
SMTP_SECURE=false                        # true for TLS in production

# -- Session --
SESSION_SECRET=change-me-to-at-least-32-characters-in-production  # [REQUIRED] [SECRET] Min 32 chars
SESSION_MAX_AGE=604800                   # 7 days in seconds

# -- Rate Limiting --
RATE_LIMIT_WINDOW_MS=60000               # 1 minute
RATE_LIMIT_MAX_REQUESTS=100              # Per window per IP
TRUST_PROXY=false                        # true when behind reverse proxy (Caddy)

# -- Upload --
UPLOAD_MAX_FILE_SIZE=10737418240         # 10 GB in bytes
UPLOAD_PRESIGNED_URL_EXPIRY=3600         # 1 hour in seconds
UPLOAD_MULTIPART_CHUNK_SIZE=10485760     # 10 MB

# -- Backup --
BACKUP_STORAGE_BUCKET=bush-backups
LITESTREAM_ENABLED=false                 # Enable SQLite streaming backup to R2

# -- Next.js Public Variables (embedded in browser bundle, NOT secrets) --
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_WS_URL=ws://localhost:3001
NEXT_PUBLIC_APP_NAME=Bush
